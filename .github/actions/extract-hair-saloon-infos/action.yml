name: Extract Hair Salon Infos
description: Extracts the city and name of the hair salon
inputs:
  index:
    description: Index of the hair salon
    required: true
outputs:
  city:
    description: The city of the hair salon
  name:
    description: The name of the hair salon
runs:
  using: composite
  steps:
    - name: Execute script
      id: extract
      run: |
          start_date="2024-01-28"
          current_date=$(date +%Y-%m-%d)
          number_of_days=$(($(($(date -u -d "$current_date" +"%s") - $(date -u -d "$start_date" +"%s"))) / 86400))
        
          echo "Number of days since $start_date: $number_of_days"
          
          name=$(jq --argjson number_of_days "$number_of_days" '.data.features[$number_of_days].properties.nom' coiffeurs.json | tr -d '"')
          city=$(jq --argjson number_of_days "$number_of_days" '.data.features[$number_of_days].properties.ville' coiffeurs.json | tr -d '"')
          address=$(jq --argjson number_of_days "$number_of_days" '.data.features[$number_of_days].properties.addresse' coiffeurs.json | tr -d '"')

          echo "Name: $name"
          echo "City: $city"
          echo "Address: $address"

          # URL encode spaces and special characters
          formatted_name=$(echo "$name" | sed 's/ /+/g' | sed "s/'/%27/g")
          formatted_address=$(echo "$address" | sed 's/ /+/g')

          echo "Formatted name: $formatted_name"
          echo "Formatted address: $formatted_address"

          # Combine name and address to form the Google Maps URL
          google_maps_url="https://www.google.com/maps/?q=${formatted_name}+${formatted_address}"

          echo "Google maps: $google_maps_url"

          # Output the city and name using GITHUB_OUTPUT
          echo "name=$name" >> $GITHUB_OUTPUT
          echo "city=$city" >> $GITHUB_OUTPUT
          echo "google_maps_url=$google_maps_url" >> $GITHUB_OUTPUT
      shell: bash